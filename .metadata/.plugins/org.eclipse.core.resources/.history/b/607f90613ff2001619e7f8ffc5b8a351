/*
 * Huffman.cpp
 *
 *  Created on: Feb 11, 2017
 *      Author: zeqingzhang
 */
#include "Huffman.h"
#include <algorithm>
#include <functional>
using namespace std;
using namespace hw05;

void Huffman::addTree(const BinaryTree& tree) noexcept{
		trees_.push_back(tree);
}




BinaryTree Huffman::applyHuffman(){
	if(trees_.size() == 0){
		throw domain_error("The size of the tree array is 0!");
	}

	if(trees_.size() == 1){
		return trees_.at(0);
	}

	for(BinaryTree tree : trees_){
		int WeightSum = 0;
		tree.traverse([&WeightSum](const string& text, double weight){
			WeightSum += weight;
		});
		tree.weight_ = WeightSum;
	}

	sort(trees_.begin(), trees_.end(), [](const BinaryTree& b1, const BinaryTree& b2){
				int b1Sum = 0;
				int b2Sum = 0;
				b1.traverse([&b1Sum](const string& text, double weight){
							b1Sum += weight;
						});
				b2.traverse([&b2Sum](const string& text, double weight){
							b2Sum += weight;
						});
				return b1Sum > b2Sum;
				});
			});
	BinaryTree left = trees_.at(trees_.size() - 2);
	BinaryTree right = trees_.at(trees_.size() - 1);
	trees_.pop_back();
	trees_.pop_back();

	BinaryTree newTree = BinaryTree(left, right);
	trees_.push_back(newTree);
	return applyHuffman();
}
